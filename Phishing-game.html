<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Phish or Legit — LOCK-IN Security Game</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- External CSS -->
  <link rel="stylesheet" href="styles1.css">
  
  <style>
    /* Minimal game-specific styles */
    .app {
      width: 90%;
      max-width: 1000px;
      margin: 120px auto 40px;
    }

    .email-stage {
      display: flex;
      gap: 24px;
      margin-bottom: 20px;
    }

    .email-view {
      flex: 1;
      background: #ffffff;
      border-radius: 12px;
      padding: 20px;
      color: #000;
      min-height: 300px;
      max-height: 400px;
      overflow-y: auto;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .email-view a {
      color: #2563eb;
      text-decoration: underline;
      cursor: pointer;
    }

    .email-view mark {
      background: rgba(251, 113, 133, 0.25);
      padding: 2px 4px;
      border-radius: 3px;
    }

    .email-view mark.highlight-ok {
      background: rgba(52, 211, 153, 0.25);
    }

    .controls {
      width: 280px;
    }

    .game-button {
      width: 100%;
      padding: 12px;
      margin-bottom: 10px;
      background: rgba(139, 92, 246, 0.2);
      border: 2px solid rgba(139, 92, 246, 0.5);
      color: #a78bfa;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
    }

    .game-button:hover:not(:disabled) {
      background: rgba(139, 92, 246, 0.4);
      box-shadow: 0 0 12px rgba(139, 92, 246, 0.5);
    }

    .game-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .progress {
      height: 8px;
      background: rgba(139, 92, 246, 0.1);
      border-radius: 10px;
      overflow: hidden;
      margin: 16px 0;
      border: 1px solid rgba(139, 92, 246, 0.2);
    }

    .progress > i {
      display: block;
      height: 100%;
      background: linear-gradient(90deg, #8b5cf6, #a78bfa);
      width: 0%;
      transition: width 0.3s ease;
    }

    .modal-game {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(5, 10, 26, 0.85);
      backdrop-filter: blur(5px);
      z-index: 2000;
    }

    .modal-game.active {
      display: flex;
    }

    .modal-panel {
      background: linear-gradient(135deg, rgba(15, 18, 32, 0.95), rgba(10, 14, 27, 0.95));
      border: 1px solid rgba(139, 92, 246, 0.3);
      padding: 24px;
      border-radius: 16px;
      width: 600px;
      max-width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
    }

    .modal-panel h3 {
      color: #a78bfa;
      margin-bottom: 12px;
    }

    .modal-panel p {
      color: #e6eef6;
      margin-bottom: 12px;
    }

    .reason-list li {
      color: #b0b0b0;
      margin-bottom: 8px;
    }

    .btn-modal {
      background: rgba(139, 92, 246, 0.2);
      border: 1px solid rgba(139, 92, 246, 0.5);
      color: #a78bfa;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .btn-modal:hover {
      background: rgba(139, 92, 246, 0.4);
      box-shadow: 0 0 12px rgba(139, 92, 246, 0.5);
    }

    @media (max-width: 860px) {
      .email-stage {
        flex-direction: column;
      }
      .controls {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
      <h1 style="font-size: 28px; font-weight: bold; color: #a78bfa;">Phish or Legit?</h1>
      <div style="background: rgba(139, 92, 246, 0.15); padding: 10px 16px; border-radius: 8px; color: #a78bfa;">
        Score: <span id="score">0</span> / <span id="max">0</span>
      </div>
    </header>

    <div class="email-stage">
      <div class="email-view" id="emailView"></div>

      <aside class="controls">
        <div style="margin-bottom: 16px;">
          <div style="font-weight: 700; color: #e6eef6; margin-bottom: 8px;" id="sender">—</div>
          <div style="color: #94a3b8; font-size: 12px; margin-bottom: 16px;" id="subject">—</div>
        </div>

        <button class="game-button" id="btnPhish">PHISH</button>
        <button class="game-button" id="btnLegit">LEGIT</button>
        <button class="game-button" id="btnReveal">REVEAL</button>

        <div class="progress"><i id="progressBar"></i></div>
        <div style="background: rgba(139, 92, 246, 0.1); padding: 12px; border-radius: 8px; color: #94a3b8; font-size: 13px;" id="roundInfo">
          Identify whether each email is phishing or legitimate.
        </div>
      </aside>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-game" id="modal">
    <div class="modal-panel">
      <h3 id="modalTitle">Answer</h3>
      <p id="modalSummary"></p>
      <ul id="modalReasons" class="reason-list"></ul>
      <div style="text-align: right; margin-top: 20px;">
        <button class="btn-modal" id="modalClose">Continue</button>
      </div>
    </div>
  </div>

  <script>
    const emails = [
      {
        id: 1,
        sender: 'support@paypal.com',
        subject: 'Action required: Reset your password',
        content: `<div><strong>PayPal</strong><p>We detected unusual activity. Please <a href="#">click here</a> to reset your password immediately to avoid account limitation.</p><p>Thank you,<br>PayPal Security Team</p></div>`,
        isPhish: true,
        reasons: ['Generic greeting with urgency', 'Vague threat of account limitation', 'Link not directly to paypal.com domain']
      },
      {
        id: 2,
        sender: 'noreply@github.com',
        subject: 'New sign-in to your GitHub account',
        content: `<div><strong>GitHub</strong><p>We noticed a new sign-in to your account from an unrecognized device. If this was you, no action is required. If not, <a href="#">secure your account</a>.</p><p>— The GitHub Team</p></div>`,
        isPhish: false,
        reasons: ['Official sender domain', 'Non-urgent, clear remediation path', 'No pressure to act immediately']
      },
      {
        id: 3,
        sender: 'accounts@apple-secure.com',
        subject: 'Your Apple ID has a problem',
        content: `<div><strong>Apple Support</strong><p>We were unable to verify the payment method on file. Please <a href="#">verify your billing</a> to restore services.</p><p>If you ignore this message your account may be charged incorrectly.</p></div>`,
        isPhish: true,
        reasons: ['Sender domain mimics Apple but is slightly off', 'Threatening language about charges', 'Pressure to click link immediately']
      },
      {
        id: 4,
        sender: 'billing@netflix.com',
        subject: 'Invoice for your recently renewed subscription',
        content: `<div><strong>Netflix</strong><p>Your subscription was successfully renewed. Amount charged: $9.99. If you have questions, visit your <a href="#">account</a>.</p></div>`,
        isPhish: false,
        reasons: ['Official sender domain', 'Specific transaction amount', 'No request for sensitive information']
      },
      {
        id: 5,
        sender: 'payroll@company-pay.com',
        subject: 'Tax documents attached — action needed',
        content: `<div><strong>Payroll Department</strong><p>Your W-2 for this year is available. Open the attached PDF or download from: <a href="#">company-pay.com/downloads</a></p><p>If you did not request this, contact HR.</p></div>`,
        isPhish: true,
        reasons: ['Domain differs from main company domain', 'Requests download of sensitive tax document', 'Social engineering using employee paperwork']
      }
    ];

    const rounds = [...emails].sort(() => Math.random() - 0.5);
    
    let current = 0;
    let score = 0;
    const max = rounds.length;

    const emailView = document.getElementById('emailView');
    const senderEl = document.getElementById('sender');
    const subjectEl = document.getElementById('subject');
    const scoreEl = document.getElementById('score');
    const maxEl = document.getElementById('max');
    const progressBar = document.getElementById('progressBar');
    const roundInfo = document.getElementById('roundInfo');
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalSummary = document.getElementById('modalSummary');
    const modalReasons = document.getElementById('modalReasons');

    const btnPhish = document.getElementById('btnPhish');
    const btnLegit = document.getElementById('btnLegit');
    const btnReveal = document.getElementById('btnReveal');
    const modalClose = document.getElementById('modalClose');

    maxEl.textContent = max;

    function renderRound() {
      const round = rounds[current];
      senderEl.textContent = round.sender;
      subjectEl.textContent = round.subject;
      emailView.innerHTML = round.content;

      const pct = Math.round((current / max) * 100);
      progressBar.style.width = pct + '%';

      const difficulty = current < 2 ? 'Easy' : current < 4 ? 'Medium' : 'Hard';
      roundInfo.innerHTML = `<strong>Round ${current + 1} of ${max}</strong> — Difficulty: <span style="color: #a78bfa;">${difficulty}</span>`;
    }

    function checkAnswer(isPhishGuess) {
      const round = rounds[current];
      const correct = round.isPhish === isPhishGuess;
      
      if (correct) {
        score++;
        scoreEl.textContent = score;
      }
      
      showModal(correct, round);
      disableButtons();
    }

    function showModal(wasCorrect, round) {
      modalTitle.textContent = wasCorrect ? '✓ Correct!' : '✗ Incorrect';
      modalSummary.textContent = wasCorrect 
        ? (round.isPhish ? 'This was a phishing email.' : 'This was legitimate.')
        : `Correct answer: ${round.isPhish ? 'PHISHING' : 'LEGITIMATE'}`;

      modalReasons.innerHTML = '';
      round.reasons.forEach(reason => {
        const li = document.createElement('li');
        li.textContent = reason;
        modalReasons.appendChild(li);
      });

      if (!wasCorrect) {
        highlightPhrases(round.reasons);
      } else {
        highlightPositive();
      }

      modal.classList.add('active');
    }

    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    function highlightPhrases(reasonArray) {
      const keywords = [];
      reasonArray.forEach(reason => {
        reason.split(/[^A-Za-z0-9\-\.]/).forEach(token => {
          if (token.length >= 4) keywords.push(token);
        });
      });

      const unique = Array.from(new Set(keywords)).sort((a, b) => b.length - a.length);
      let html = emailView.innerHTML;

      unique.slice(0, 8).forEach(keyword => {
        const regex = new RegExp('(' + escapeRegExp(keyword) + ')', 'gi');
        html = html.replace(regex, '<mark>$1</mark>');
      });

      emailView.innerHTML = html;
    }

    function highlightPositive() {
      const safeWords = ['GitHub', 'Netflix', 'transaction', 'renewed', 'official', 'domain'];
      let html = emailView.innerHTML;
      
      safeWords.forEach(word => {
        const regex = new RegExp('(' + escapeRegExp(word) + ')', 'gi');
        html = html.replace(regex, '<mark class="highlight-ok">$1</mark>');
      });

      emailView.innerHTML = html;
    }

    function disableButtons() {
      btnPhish.disabled = true;
      btnLegit.disabled = true;
      btnReveal.disabled = true;
    }

    function enableButtons() {
      btnPhish.disabled = false;
      btnLegit.disabled = false;
      btnReveal.disabled = false;
    }

    function endGame() {
      emailView.innerHTML = `<div style="padding: 20px; text-align: center;">
        <h2 style="color: #a78bfa; margin-bottom: 16px;">Game Complete!</h2>
        <p style="font-size: 18px; margin-bottom: 8px;">Your Score: <strong style="color: #34d399;">${score} / ${max}</strong></p>
        <p style="color: #94a3b8;">Great job practicing email security! Remember these skills when checking real emails.</p>
      </div>`;
      
      senderEl.textContent = '—';
      subjectEl.textContent = '—';
      progressBar.style.width = '100%';
      roundInfo.innerHTML = '<strong>You completed all rounds!</strong>';
      disableButtons();
    }

    btnPhish.addEventListener('click', () => checkAnswer(true));
    btnLegit.addEventListener('click', () => checkAnswer(false));
    
    btnReveal.addEventListener('click', () => {
      showModal(false, rounds[current]);
      disableButtons();
    });

    modalClose.addEventListener('click', () => {
      modal.classList.remove('active');
      current++;
      
      if (current >= max) {
        endGame();
      } else {
        enableButtons();
        renderRound();
      }
    });

    renderRound();
    enableButtons();
  </script>
</body>
</html>

